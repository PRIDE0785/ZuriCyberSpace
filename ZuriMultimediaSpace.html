<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>ZuriMultimediaSpace (Firebase) — multimedia store</title>
<meta name="description" content="ZuriMultimediaSpace: Upload, browse & download videos, reels, posters and order multimedia services."/>
<style>
  /* --------- Simple mobile-first styling (improved responsiveness) --------- */
  :root{ --bg:#041022; --panel:#07142a; --muted:#9fb0c8; --accent1:#6d28d9; --accent2:#8b5cf6; --glass: rgba(255,255,255,0.03); --card-radius:12px; }
  *{box-sizing:border-box} body{margin:0;font-family:Inter,system-ui,Arial;color:#e8f0ff;background:linear-gradient(180deg,#021226 0%,#03132a 100%);-webkit-font-smoothing:antialiased}
  .wrap{max-width:1100px;margin:18px auto;padding:12px}
  header{display:flex;align-items:center;justify-content:space-between;gap:12px}
  .brand{display:flex;align-items:center;gap:12px}
  .logo{width:46px;height:46px;border-radius:10px;background:linear-gradient(135deg,var(--accent1),var(--accent2));display:flex;align-items:center;justify-content:center;font-weight:800;color:#fff}
  h1{font-size:1rem;margin:0}
  .top-actions{display:flex;gap:8px}
  .btn{background:linear-gradient(90deg,var(--accent1),var(--accent2));border:0;padding:10px 12px;border-radius:10px;color:#fff;font-weight:700;cursor:pointer}
  .btn.ghost{background:transparent;border:1px solid rgba(255,255,255,0.06);color:var(--muted)}
  .layout{display:grid;grid-template-columns:260px 1fr;gap:12px;margin-top:14px}
  aside{background:var(--panel);padding:12px;border-radius:10px;border:1px solid rgba(255,255,255,0.02)}
  nav button{display:block;width:100%;text-align:left;padding:10px;border-radius:8px;background:transparent;border:0;color:inherit;margin-bottom:6px;cursor:pointer}
  nav button.active{background:rgba(255,255,255,0.02)}
  .mobile-hamburger{display:none}
  main{padding:12px;background:linear-gradient(180deg, rgba(255,255,255,0.01), transparent);border-radius:10px}
  .hero{display:flex;justify-content:space-between;align-items:center;gap:12px;padding:12px;border-radius:10px;background:linear-gradient(90deg, rgba(139,92,246,0.08), rgba(109,40,217,0.06));}
  .grid-media{display:grid;grid-template-columns:repeat(auto-fill,minmax(220px,1fr));gap:12px;margin-top:12px}
  .card{background:var(--panel);padding:8px;border-radius:10px;border:1px solid rgba(255,255,255,0.02);display:flex;flex-direction:column;height:100%}
  .thumb{height:160px;border-radius:8px;overflow:hidden;background:#020b12;display:flex;align-items:center;justify-content:center}
  .thumb img,.thumb video{width:100%;height:100%;object-fit:cover}
  .meta{display:flex;justify-content:space-between;align-items:center;margin-top:8px}
  .meta .title{font-weight:700}
  .actions{display:flex;gap:8px;margin-top:10px}
  .actions button{flex:1;padding:8px;border-radius:8px;border:0;cursor:pointer}
  .download{background:rgba(255,255,255,0.03);color:#fff}
  .add{background:linear-gradient(90deg,#06b6d4,#0ea5a4);color:#002}
  .panel{background:var(--panel);padding:12px;border-radius:10px;border:1px solid rgba(255,255,255,0.02)}
  .small{color:var(--muted);font-size:13px}
  footer{margin-top:12px;text-align:center;color:var(--muted);font-size:13px}
  /* responsive */
  @media (max-width:980px){
    .layout{grid-template-columns:1fr}
    aside{display:flex;gap:8px;overflow:auto;padding:8px}
    nav{display:flex;gap:8px}
    .mobile-hamburger{display:block}
  }
</style>
</head>
<body>
<div class="wrap" id="app">
  <header>
    <div class="brand">
      <div class="logo">Z</div>
      <div>
        <h1>ZuriMultimediaSpace</h1>
        <div class="small">Upload & sell videos, reels, posters — powered by Firebase</div>
      </div>
    </div>
    <div class="top-actions">
      <button id="hamb" class="btn ghost mobile-hamburger">Menu</button>
      <input id="search" type="search" placeholder="Search media..." style="padding:8px;border-radius:8px;border:1px solid rgba(255,255,255,0.04);background:transparent;color:#fff" />
      <button id="openUpload" class="btn">Publish</button>
      <button id="openServices" class="btn ghost">Order Service</button>
    </div>
  </header>

  <div class="layout">
    <aside aria-label="left nav">
      <nav id="nav">
        <button data-view="explore" class="active">Explore</button>
        <button data-view="upload">Upload</button>
        <button data-view="services">Services</button>
        <button data-view="orders">My Orders</button>
      </nav>

      <div style="height:12px"></div>
      <div class="small">Category</div>
      <select id="category" style="width:100%;padding:8px;border-radius:8px;background:transparent;border:1px solid rgba(255,255,255,0.04);margin-top:6px">
        <option value="all">All</option>
        <option value="video">Videos</option>
        <option value="reel">Reels</option>
        <option value="poster">Posters</option>
        <option value="design">Designs</option>
      </select>

      <div style="height:12px"></div>
      <div class="small">Cart</div>
      <div id="cartSummary" class="small">Items: 0</div>
      <div style="height:8px"></div>
      <button id="checkoutBtn" class="btn ghost" style="width:100%">Checkout</button>

      <div style="height:12px"></div>
      <div class="small">Contact</div>
      <div class="small">WA: +256 779 185824</div>
      <div class="small">Email: paddypride6@mail.com</div>
    </aside>

    <main>
      <div id="viewArea">
        <!-- HERO / EXPLORE -->
        <section data-view="explore" class="view">
          <div class="hero">
            <div>
              <h2 style="margin:0">Explore</h2>
              <div class="small">Browse public media — videos, reels, posters and designs.</div>
            </div>
            <div style="display:flex;gap:8px">
              <button id="btnRefresh" class="btn ghost">Refresh</button>
            </div>
          </div>

          <div id="mediaGrid" class="grid-media" aria-live="polite"></div>
          <div id="emptyHint" class="small" style="text-align:center;margin-top:12px;display:none;color:var(--muted)">No media yet — publish something.</div>
        </section>

        <!-- UPLOAD -->
        <section data-view="upload" class="view" style="display:none">
          <h3>Publish New Media</h3>
          <div style="height:8px"></div>
          <div class="panel">
            <form id="uploadForm">
              <div style="display:flex;gap:8px;flex-wrap:wrap">
                <input name="title" placeholder="Title (optional)" style="flex:1;padding:10px;border-radius:8px;background:transparent;border:1px solid rgba(255,255,255,0.04)" />
                <select name="type" required style="padding:10px;border-radius:8px;background:transparent;border:1px solid rgba(255,255,255,0.04);min-width:140px">
                  <option value="video">Video</option>
                  <option value="reel">Reel</option>
                  <option value="poster">Poster</option>
                  <option value="design">Design</option>
                </select>
              </div>
              <div style="height:8px"></div>
              <textarea name="description" rows="3" placeholder="Short description (optional)" style="width:100%;padding:10px;border-radius:8px;background:transparent;border:1px solid rgba(255,255,255,0.04)"></textarea>
              <div style="height:8px"></div>
              <input name="file" type="file" accept="image/*,video/*" required />
              <div style="height:8px"></div>
              <div class="small">Max file: 200MB recommended for demo (you can configure limits in the console).</div>
              <div style="height:8px"></div>
              <div style="display:flex;gap:8px">
                <button type="submit" class="btn">Upload to Cloud</button>
                <button id="cancelUpload" type="button" class="btn ghost">Cancel</button>
              </div>

              <div id="uploadProgress" style="margin-top:10px"></div>
            </form>
          </div>
        </section>

        <!-- SERVICES -->
        <section data-view="services" class="view" style="display:none">
          <h3>Order a Service</h3>
          <div style="height:8px"></div>
          <div class="panel">
            <form id="serviceForm">
              <div style="display:flex;gap:8px;flex-wrap:wrap">
                <select name="service" required style="padding:10px;border-radius:8px;background:transparent;border:1px solid rgba(255,255,255,0.04);min-width:200px">
                  <option value="poster">Poster</option>
                  <option value="banner">Banner</option>
                  <option value="flyer">Flyer</option>
                  <option value="animation">Animation</option>
                  <option value="advert">Advert</option>
                  <option value="videography">Videography</option>
                  <option value="photography">Photography</option>
                </select>
                <input name="quantity" type="number" min="1" value="1" style="padding:10px;border-radius:8px;background:transparent;border:1px solid rgba(255,255,255,0.04);width:120px">
                <input name="deadline" type="date" style="padding:10px;border-radius:8px;background:transparent;border:1px solid rgba(255,255,255,0.04)">
              </div>
              <div style="height:8px"></div>
              <textarea name="details" rows="4" placeholder="Describe what you need (sizes, colors, text, references)" style="width:100%;padding:10px;border-radius:8px;background:transparent;border:1px solid rgba(255,255,255,0.04)"></textarea>
              <div style="height:8px"></div>
              <div style="display:flex;gap:8px">
                <button type="submit" class="btn">Order via WhatsApp</button>
                <button id="orderEmail" type="button" class="btn ghost">Order via Email</button>
              </div>
              <div style="height:8px"></div>
              <div class="small" style="color:var(--muted)">Orders open WhatsApp to send to +256779185824 and also open email to paddypride6@mail.com.</div>
            </form>
          </div>
        </section>

        <!-- ORDERS -->
        <section data-view="orders" class="view" style="display:none">
          <h3>Your Orders</h3>
          <div style="height:8px"></div>
          <div id="ordersArea" class="panel">
            <!-- orders listed here -->
          </div>
        </section>
      </div>

      <footer>
        ZuriMultimediaSpace — powered by Firebase (Storage + Firestore). Uploads are stored in the cloud and served to visitors.
      </footer>
    </main>
  </div>
</div>

<!-- ============================
     Firebase SDKs (CDN, compat mode)
     Replace versions if needed.
     Docs: https://firebase.google.com/docs/web/setup#add-sdks-initialize
     ============================ -->
<script src="https://www.gstatic.com/firebasejs/9.22.2/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.22.2/firebase-auth-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.22.2/firebase-storage-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.22.2/firebase-firestore-compat.js"></script>

<script>
/* ========= CONFIGURATION - REPLACE WITH YOUR FIREBASE CONFIG =========
  1) Create a Firebase project: https://console.firebase.google.com/
  2) Add a Web App and copy the firebaseConfig object into the block below.
  3) In the console enable: Authentication (Anonymous), Firestore, Storage.
  4) Set Storage rules to allow read (or secure as you require) for public gallery.
     See docs: https://firebase.google.com/docs/storage/web/upload-files
*/
const firebaseConfig = {
  apiKey: "REPLACE_ME",
  authDomain: "REPLACE_ME.firebaseapp.com",
  projectId: "REPLACE_ME",
  storageBucket: "REPLACE_ME.appspot.com",
  messagingSenderId: "REPLACE_ME",
  appId: "REPLACE_ME"
};

firebase.initializeApp(firebaseConfig);
const auth = firebase.auth();
const storage = firebase.storage();
const db = firebase.firestore();

/* --------- Sign in anonymously (creates a user for safe writes) --------- */
auth.signInAnonymously().catch(err => {
  console.error('Auth error', err);
});

/* ========== Application logic ========== */
const CONTACT_WA = '256779185824';
const CONTACT_EMAIL = 'paddypride6@mail.com';

const nav = document.getElementById('nav');
const views = document.querySelectorAll('[data-view]');
const mediaGrid = document.getElementById('mediaGrid');
const emptyHint = document.getElementById('emptyHint');
const cartSummary = document.getElementById('cartSummary');
const checkoutBtn = document.getElementById('checkoutBtn');
const searchInput = document.getElementById('search');
const categorySelect = document.getElementById('category');
const uploadForm = document.getElementById('uploadForm');
const uploadProgress = document.getElementById('uploadProgress');
const ordersArea = document.getElementById('ordersArea');

let cart = JSON.parse(localStorage.getItem('zuri_cart') || '[]');
let orders = JSON.parse(localStorage.getItem('zuri_orders') || '[]');

/* Navigation */
nav.addEventListener('click', ev => {
  if (ev.target.matches('button')) {
    [...nav.querySelectorAll('button')].forEach(b => b.classList.remove('active'));
    ev.target.classList.add('active');
    showView(ev.target.dataset.view);
  }
});
function showView(name){
  views.forEach(v => v.dataset.view === name ? v.style.display = '' : v.style.display = 'none');
}
showView('explore');

/* Search & filters */
searchInput.addEventListener('input', renderFromFirestore);
categorySelect.addEventListener('change', renderFromFirestore);

/* Open upload/services */
document.getElementById('openUpload').addEventListener('click', () => {
  [...nav.querySelectorAll('button')].forEach(b => b.classList.toggle('active', b.dataset.view === 'upload'));
  showView('upload');
});
document.getElementById('openServices').addEventListener('click', () => {
  [...nav.querySelectorAll('button')].forEach(b => b.classList.toggle('active', b.dataset.view === 'services'));
  showView('services');
});

/* Cancel upload */
document.getElementById('cancelUpload').addEventListener('click', () => {
  uploadForm.reset();
  uploadProgress.innerHTML = '';
  [...nav.querySelectorAll('button')].forEach(b => b.classList.toggle('active', b.dataset.view === 'explore'));
  showView('explore');
});

/* Upload to Firebase Storage & save metadata to Firestore */
uploadForm.addEventListener('submit', async (ev) => {
  ev.preventDefault();
  const title = uploadForm.title.value.trim() || 'Untitled';
  const description = uploadForm.description.value.trim();
  const type = uploadForm.type.value;
  const file = uploadForm.file.files[0];
  if (!file) return alert('Choose a file.');

  // file size check (optional)
  const maxBytes = 200 * 1024 * 1024; // 200 MB
  if (file.size > maxBytes) return alert('File too large (max 200MB). Use smaller file.');

  // Storage path: media/<timestamp>_<filename>
  const path = `media/${Date.now()}_${sanitizeFilename(file.name)}`;
  const ref = storage.ref().child(path);
  const uploadTask = ref.put(file);

  uploadProgress.innerHTML = `<div class="small">Uploading ${file.name} ...</div>`;

  uploadTask.on('state_changed',
    (snapshot) => {
      const pct = Math.round((snapshot.bytesTransferred / snapshot.totalBytes) * 100);
      uploadProgress.innerHTML = `<div class="small">Upload: ${pct}%</div>`;
    },
    (err) => {
      console.error(err);
      uploadProgress.innerHTML = `<div class="small" style="color:#ffb3b3">Upload error: ${err.message}</div>`;
    },
    async () => {
      // Completed - get public download URL
      const downloadURL = await ref.getDownloadURL();
      // Save metadata to Firestore
      const doc = {
        title, description, type, path, downloadURL,
        filename: file.name, mime: file.type, size: file.size,
        price: (type === 'poster' || type === 'design') ? 3 : 5,
        createdAt: firebase.firestore.FieldValue.serverTimestamp()
      };
      await db.collection('media').add(doc);
      uploadProgress.innerHTML = `<div class="small" style="color:#b8ffda">Uploaded successfully.</div>`;
      uploadForm.reset();
      renderFromFirestore();
      // Jump to explore
      [...nav.querySelectorAll('button')].forEach(b => b.classList.toggle('active', b.dataset.view === 'explore'));
      showView('explore');
    }
  );
});

/* Render gallery by reading Firestore 'media' collection */
let lastListener = null;
function renderFromFirestore(){
  // unsubscribe previous listener if any (for real-time updates)
  if (lastListener) lastListener();
  const qtext = searchInput.value.trim().toLowerCase();
  const cat = categorySelect.value;

  // Query: order by createdAt desc
  let queryRef = db.collection('media').orderBy('createdAt','desc').limit(200);
  // Real-time snapshot (keeps gallery updated for everyone)
  lastListener = queryRef.onSnapshot(snapshot => {
    const docs = [];
    snapshot.forEach(doc => {
      docs.push({ id: doc.id, ...doc.data() });
    });
    // client-side filter for search/category (simple)
    let visible = docs;
    if (cat !== 'all') visible = visible.filter(d => d.type === cat);
    if (qtext) visible = visible.filter(d => ((d.title||'') + ' ' + (d.description||'')).toLowerCase().includes(qtext));
    renderGallery(visible);
  }, err => {
    console.error('Firestore snapshot error', err);
  });
}

/* Render gallery UI */
function renderGallery(items){
  mediaGrid.innerHTML = '';
  if (!items || items.length === 0) { emptyHint.style.display = ''; return; }
  emptyHint.style.display = 'none';
  items.forEach(item => {
    const card = document.createElement('div'); card.className = 'card';
    const thumb = document.createElement('div'); thumb.className = 'thumb';
    if (item.mime && item.mime.startsWith('video')) {
      const v = document.createElement('video'); v.src = item.downloadURL; v.controls = true; thumb.appendChild(v);
    } else {
      const img = document.createElement('img'); img.src = item.downloadURL; img.alt = item.title || 'media'; thumb.appendChild(img);
    }
    card.appendChild(thumb);

    const meta = document.createElement('div'); meta.className = 'meta';
    const left = document.createElement('div'); left.innerHTML = `<div class="title">${escapeHtml(item.title||item.filename||'Untitled')}</div><div class="small" style="color:var(--muted)">${escapeHtml(item.description||item.type)}</div>`;
    const right = document.createElement('div'); right.innerHTML = `<div style="font-weight:800">$${item.price||5}</div>`;
    meta.appendChild(left); meta.appendChild(right);
    card.appendChild(meta);

    const actions = document.createElement('div'); actions.className = 'actions';
    const dl = document.createElement('button'); dl.className = 'download'; dl.textContent = 'Download';
    dl.addEventListener('click', () => downloadURL(item.downloadURL, item.filename || item.title || 'file'));
    const add = document.createElement('button'); add.className = 'add'; add.textContent = 'Add to Cart';
    add.addEventListener('click', () => { addToCart(item); });
    actions.appendChild(dl); actions.appendChild(add);
    card.appendChild(actions);

    mediaGrid.appendChild(card);
  });
}

/* Cart */
function addToCart(item){
  cart.push(item);
  localStorage.setItem('zuri_cart', JSON.stringify(cart));
  updateCartUI();
  alert('Added to cart.');
}
function updateCartUI(){ cartSummary.textContent = `Items: ${cart.length}`; }

/* Download helper (opens file in new tab or triggers save) */
function downloadURL(url, filename){
  // open in new tab — user can save
  const a = document.createElement('a');
  a.href = url;
  a.target = '_blank';
  a.download = filename;
  document.body.appendChild(a);
  a.click();
  a.remove();
}

/* Checkout (mock) */
checkoutBtn.addEventListener('click', () => {
  if (cart.length === 0) return alert('Cart empty.');
  const total = cart.reduce((s,i)=>s + (i.price||5), 0);
  if (!confirm(`Pay $${total} for ${cart.length} item(s)? (Demo — no real payment)`)) return;
  alert('Simulated payment succeeded. Downloading items...');
  setTimeout(() => {
    cart.forEach(i => downloadURL(i.downloadURL, i.filename || i.title || 'file'));
    cart = []; localStorage.setItem('zuri_cart', JSON.stringify(cart)); updateCartUI();
  }, 600);
});

/* Orders: WhatsApp + Email as before */
const serviceForm = document.getElementById('serviceForm');
const orderEmailBtn = document.getElementById('orderEmail');

serviceForm.addEventListener('submit', (ev) => {
  ev.preventDefault();
  const fd = new FormData(serviceForm);
  const service = fd.get('service'), quantity = fd.get('quantity')||1, deadline = fd.get('deadline')||'ASAP', details = fd.get('details')||'';
  const order = { id: 'o_'+Date.now(), service, quantity, deadline, details, createdAt: new Date().toISOString() };
  // save local list
  orders.unshift(order); localStorage.setItem('zuri_orders', JSON.stringify(orders)); renderOrders();

  const message = encodeURIComponent(`Hello ZuriMultimediaSpace!\nI want to order: ${service}\nQuantity: ${quantity}\nDeadline: ${deadline}\nDetails: ${details}`);
  const wa = `https://wa.me/${CONTACT_WA}?text=${message}`;
  // open WhatsApp in new tab
  window.open(wa,'_blank');
  // open mail client as fallback
  const subj = encodeURIComponent(`Order: ${service} — ZuriMultimediaSpace`);
  const body = encodeURIComponent(`Service: ${service}\nQuantity: ${quantity}\nDeadline: ${deadline}\nDetails:\n${details}\n\nRegards,\n`);
  window.location.href = `mailto:${CONTACT_EMAIL}?subject=${subj}&body=${body}`;
});

orderEmailBtn.addEventListener('click', () => {
  const fd = new FormData(serviceForm);
  const service = fd.get('service')||'', quantity = fd.get('quantity')||1, deadline = fd.get('deadline')||'ASAP', details = fd.get('details')||'';
  const subj = encodeURIComponent(`Order: ${service} — ZuriMultimediaSpace`);
  const body = encodeURIComponent(`Service: ${service}\nQuantity: ${quantity}\nDeadline: ${deadline}\nDetails:\n${details}\n\nRegards,\n`);
  window.location.href = `mailto:${CONTACT_EMAIL}?subject=${subj}&body=${body}`;
});

/* Render orders saved locally */
function renderOrders(){
  ordersArea.innerHTML = '';
  if (!orders || orders.length === 0) { ordersArea.innerHTML = `<div class="small" style="color:var(--muted)">No orders yet.</div>`; return; }
  orders.forEach(o => {
    const el = document.createElement('div'); el.style.padding='8px'; el.style.marginBottom='8px'; el.style.borderRadius='8px'; el.style.background='rgba(255,255,255,0.01)';
    el.innerHTML = `<div style="display:flex;justify-content:space-between;align-items:center">
      <div><div style="font-weight:800">${escapeHtml(o.service)}</div><div class="small" style="color:var(--muted)">${escapeHtml(o.details||'—')}</div></div>
      <div style="text-align:right"><div class="small" style="color:var(--muted)">${new Date(o.createdAt).toLocaleString()}</div><div style="font-weight:700">Qty: ${o.quantity}</div></div>
    </div>`;
    ordersArea.appendChild(el);
  });
}

/* Utilities */
function escapeHtml(s){ if (!s) return ''; return s.replace(/[&<>"']/g, c=>({'&':'&amp;','<':'&lt;','>':'&gt;','"':'&quot;',"'":'&#39;'}[c])); }
function sanitizeFilename(name){ return name.replace(/[^a-zA-Z0-9_.\-]/g,'_'); }

/* Initial load */
renderFromFirestore(); renderOrders(); updateCartUI();

/* Optional: Refresh button */
document.getElementById('btnRefresh').addEventListener('click', renderFromFirestore);

/* End of script */
</script>
</body>
</html>
